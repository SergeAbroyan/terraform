# Add Swap Space
- name: Create a swap file
  command: fallocate -l 1G /swapfile
  args:
    creates: /swapfile

- name: Set permissions on the swap file
  file:
    path: /swapfile
    mode: '0600'

- name: Make the swap file usable
  command: mkswap /swapfile
  when: ansible_facts.swapfree_mb == 0  # Only if no swap is currently available

- name: Enable the swap file
  command: swapon /swapfile
  when: ansible_facts.swapfree_mb == 0

- name: Ensure swap is enabled on reboot
  lineinfile:
    path: /etc/fstab
    line: "/swapfile none swap sw 0 0"
    state: present

# Install Python3
- name: Ensure Python3 is installed
  raw: sudo dnf install -y python3 || sudo yum install -y python3
  changed_when: false

# Update All Packages
- name: Update all packages
  dnf:
    name: "*"
    state: latest
    update_cache: yes

# Install pip for Python3
- name: Install pip for Python3
  dnf:
    name: python3-pip
    state: present
